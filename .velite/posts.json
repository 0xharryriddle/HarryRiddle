[{"slug":"posts/harry-riddle-how-to-integrate-a-light-client-in-decentralized-application-on-polkadot-network","title":"How to integrate a Light Client in Decentralized Application on Polkadot Network","date":"2024-10-29T17:00:00.000Z","published":true,"body":"const{Fragment:e,jsx:t,jsxs:n}=arguments[0];function _createMdxContent(i){const o={a:\"a\",blockquote:\"blockquote\",del:\"del\",em:\"em\",h1:\"h1\",h3:\"h3\",h4:\"h4\",hr:\"hr\",img:\"img\",li:\"li\",p:\"p\",strong:\"strong\",ul:\"ul\",...i.components};return n(e,{children:[t(o.h1,{id:\"how-to-integrate-a-light-client-in-decentralized-application-on-polkadot-network\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#how-to-integrate-a-light-client-in-decentralized-application-on-polkadot-network\",children:\"How to integrate a Light Client in Decentralized Application on Polkadot Network\"})}),\"\\n\",t(o.h3,{id:\"introduction\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#introduction\",children:\"Introduction\"})}),\"\\n\",t(o.p,{children:\"Blockchain interactions require communication with a Peer-to-Peer (P2P) network to validate transactions and generate new blocks. Polkadot, like other blockchains, relies on a network of nodes that powers its consensus mechanism.\"}),\"\\n\",n(o.p,{children:[t(o.a,{href:\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2f3cf6e7-8ec7-4622-8338-6f8d1d1ef6a8_365x250.png\",children:t(o.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2f3cf6e7-8ec7-4622-8338-6f8d1d1ef6a8_365x250.png\",alt:\"How to set up and run a full node on Polkadot?\"})}),\"Source: \",t(o.strong,{children:t(o.a,{href:\"https://www.leewayhertz.com/how-to-set-up-a-full-node-on-polkadot/\",children:\"How to set up and run a full node on Polkadot?\"})})]}),\"\\n\",t(o.p,{children:\"To communicate between the decentralized application and a network node in Polkadot is through a JSON RPC protocol. Typically, there are 2 main ways to do this:\"}),\"\\n\",n(o.ul,{children:[\"\\n\",n(o.li,{children:[\"\\n\",n(o.p,{children:[t(o.strong,{children:\"User-Controlled Nodes:\"}),\" The \",t(o.strong,{children:\"Dapp (decentralized application)\"}),\" connects to a node client which the users have installed and run on their machine. These nodes are extremely secure because the users fully control it, but to install and maintain them are quietly complicated as they must be active 24/7 and connect with network rapidly.\"]}),\"\\n\"]}),\"\\n\",n(o.li,{children:[\"\\n\",n(o.p,{children:[t(o.strong,{children:\"Publicly-Accessible Nodes:\"}),\" There are several third-parties or platforms providing a publicly-accessible node client. These nodes are available every time when users need so they are more convenient to interact. However, their drawbacks are insecure and centralized because they are controlled by their owner.\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",t(o.p,{children:\"Substrate Connect, on the other hand, is introduced for decentralized application to minimally connect to Polkadot network instead of utilizing a centralized RPC node but still securely.\"}),\"\\n\",t(o.h3,{id:\"enter-substrate-connect-a-minimalistic-decentralized-solution\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#enter-substrate-connect-a-minimalistic-decentralized-solution\",children:\"Enter Substrate Connect: A Minimalistic, Decentralized Solution\"})}),\"\\n\",n(o.p,{children:[t(o.strong,{children:t(o.a,{href:\"https://substrate.io/substrate-connect/\",children:\"Substrate Connect\"})}),\" offers a secure and decentralized alternative to centralized RPC nodes. As a JavaScript library and browser extension, it enables developers to build \",t(o.strong,{children:\"light clients\"}),\" for Substrate chains directly in a Dapp, using \",t(o.strong,{children:t(o.a,{href:\"https://polkadot.js.org/docs/api/\",children:\"PolkadotJS API\"})}),\" (a collection of JavaScript tools, utilities and libraries for interacting with the Polkadot network).\"]}),\"\\n\",n(o.p,{children:[\"With Substrate Connect, there‚Äôs no need for a centralized RPC node; it operates like a bridge, running **\",t(o.a,{href:\"https://github.com/smol-dot/smoldot\",children:\"Smoldot\"}),\" **in the browser extension. This replaces the now-deprecated \",t(o.strong,{children:t(o.a,{href:\"https://github.com/paritytech/substrate\",children:t(o.del,{children:\"Substrate\"})})}),\" and offers a robust alternative for \",t(o.strong,{children:t(o.a,{href:\"https://github.com/paritytech/substrate\",children:\"Substrate\"})}),\" -based chains.\"]}),\"\\n\",t(o.h3,{id:\"why-use-substrate-connect\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#why-use-substrate-connect\",children:\"Why Use Substrate Connect?\"})}),\"\\n\",n(o.p,{children:[t(o.strong,{children:\"Polkadot\"}),\" is designed with decentralization at its core, following the \",t(o.strong,{children:\"Blockchain Trilemma\"}),\" ( \",t(o.strong,{children:\"Decentralization\"}),\" , \",t(o.strong,{children:\"Security\"}),\" , and \",t(o.strong,{children:\"Scalability\"}),\" ). However, most user interfaces connect to the network through centralized nodes, making decentralization challenging. \",t(o.strong,{children:t(o.a,{href:\"https://substrate.io/substrate-connect/\",children:\"Substrate Connect\"})}),\" provides a lightweight, decentralized option for DApps to interact securely with Polkadot, lowering complexity for end-users.\"]}),\"\\n\",t(o.h3,{id:\"integrating-the-light-client\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#integrating-the-light-client\",children:\"Integrating the Light Client!\"})}),\"\\n\",n(o.p,{children:[\"This guide walks you through integrating a Light Client with **\",t(o.a,{href:\"https://github.com/smol-dot/smoldot\",children:\"Smoldot\"}),\" , \",t(o.a,{href:\"https://substrate.io/substrate-connect/\",children:\"Substrate Connect\"}),\" **and \",t(o.strong,{children:t(o.a,{href:\"https://docs.dedot.dev/\",children:\"Dedot\"})}),\" (an alternative to \",t(o.strong,{children:t(o.a,{href:\"https://polkadot.js.org/docs/api/\",children:\"PolkadotJS API\"})}),\" ) in a Voting Escrow application.\"]}),\"\\n\",n(o.p,{children:[\"Our repository is using \",t(o.strong,{children:\"Next.Js\"}),\" framework to build the \",t(o.strong,{children:\"User-Interface\"}),\" \",t(o.strong,{children:\"Application\"}),\" for Decentralized Application:\"]}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client\",children:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client\"})}),\"\\n\",t(o.hr,{}),\"\\n\",n(o.blockquote,{children:[\"\\n\",t(o.h4,{id:\"prepare-the-chain-specification-json\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#prepare-the-chain-specification-json\",children:t(o.strong,{children:\"Prepare the Chain Specification JSON\"})})}),\"\\n\"]}),\"\\n\",t(o.p,{children:\"Firstly, we must prepare the chain specification json file for the Relaychain or Parachain. We can find the chain specification of our expected network in Substrate Connect repository.\"}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://github.com/paritytech/substrate-connect/tree/main/packages/connect-known-chains/specs\",children:\"https://github.com/paritytech/substrate-connect/tree/main/packages/connect-known-chains/specs\"})}),\"\\n\",n(o.blockquote,{children:[\"\\n\",t(o.h4,{id:\"install-dependencies\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#install-dependencies\",children:\"Install Dependencies\"})}),\"\\n\"]}),\"\\n\",n(o.p,{children:[\"Install necessary packages such as \",t(o.strong,{children:\"smoldot\"}),\" , \",t(o.strong,{children:\"@dedot/chaintypes\"}),\" and a compatible version of \",t(o.strong,{children:\"Dedot\"}),\" :\"]}),\"\\n\",t(o.p,{children:\"npm install smoldot dedot@0.5.0 @dedot/chaintypes\"}),\"\\n\",n(o.blockquote,{children:[\"\\n\",t(o.h4,{id:\"implement-substrate-connect-provider-and-client\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#implement-substrate-connect-provider-and-client\",children:t(o.strong,{children:\"Implement Substrate Connect Provider and Client\"})})}),\"\\n\"]}),\"\\n\",n(o.p,{children:[\"Set up the \",t(o.strong,{children:\"Substrate Connect Provider\"}),\" and \",t(o.strong,{children:\"Client\"}),\" in a custom hook for use in your \",t(o.strong,{children:\"Next.js\"}),\" or \",t(o.strong,{children:\"React\"}),\" project:\"]}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/blob/main/src/hooks/useApi.ts\",children:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/blob/main/src/hooks/useApi.ts\"})}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad2d53e7-f2c3-4ae1-9c41-c96d987e8bba_1514x2390.png\",children:t(o.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad2d53e7-f2c3-4ae1-9c41-c96d987e8bba_1514x2390.png\",alt:\"\"})})}),\"\\n\",n(o.blockquote,{children:[\"\\n\",t(o.h4,{id:\"configure-api-context-for-project-layout\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#configure-api-context-for-project-layout\",children:\"Configure API Context for Project Layout\"})}),\"\\n\"]}),\"\\n\",t(o.p,{children:\"Integrate the Light Client provider across your application with an API Context setup:\"}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/blob/main/src/providers/ApiProvider.tsx\",children:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/blob/main/src/providers/ApiProvider.tsx\"})}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2f375d61-ff45-4a1d-9d80-b35dbf605ef2_1514x2876.png\",children:t(o.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2f375d61-ff45-4a1d-9d80-b35dbf605ef2_1514x2876.png\",alt:\"\"})})}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/tree/main/src/app\",children:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/tree/main/src/app\"})}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F42e11e8b-4212-4d0f-80b5-7d9b7baf210e_1514x1460.png\",children:t(o.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F42e11e8b-4212-4d0f-80b5-7d9b7baf210e_1514x1460.png\",alt:\"\"})})}),\"\\n\",n(o.blockquote,{children:[\"\\n\",t(o.h4,{id:\"test-the-light-client-connection\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#test-the-light-client-connection\",children:\"Test the Light Client Connection\"})}),\"\\n\"]}),\"\\n\",t(o.p,{children:\"Run our application with:\"}),\"\\n\",t(o.p,{children:\"npm run dev\"}),\"\\n\",t(o.p,{children:\"If successful, you‚Äôll see confirmation in the browser console üéâ. This confirms your Light Client is now operational within your Dapp!\"}),\"\\n\",t(o.p,{children:t(o.a,{href:\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4a3718a3-c5bb-44ce-9419-5d101b2497d7_1910x314.png\",children:t(o.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4a3718a3-c5bb-44ce-9419-5d101b2497d7_1910x314.png\",alt:\"\"})})}),\"\\n\",n(o.p,{children:[\"In this context, we used the \",t(o.strong,{children:\"Edge Browser\"}),\" to access to our application.\"]}),\"\\n\",n(o.blockquote,{children:[\"\\n\",t(o.h4,{id:\"interact-with-smart-contracts\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#interact-with-smart-contracts\",children:\"Interact with Smart Contracts\"})}),\"\\n\"]}),\"\\n\",n(o.p,{children:[\"Using the ‚Äúapi‚Äù client from the API Context, interact with the Relaychain or Parachain via \",t(o.strong,{children:t(o.a,{href:\"https://docs.dedot.dev/\",children:\"Dedot SDK\"})}),\" or \",t(o.strong,{children:t(o.a,{href:\"https://polkadot.js.org/docs/api/\",children:\"PolkadotJS API\"})}),\" to call smart contracts.\"]}),\"\\n\",t(o.h3,{id:\"challenges-\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#challenges-\",children:\"Challenges üí™üèª\"})}),\"\\n\",n(o.ul,{children:[\"\\n\",n(o.li,{children:[\"The \",t(o.strong,{children:\"Smoldot SDK\"}),\" supports \",t(o.strong,{children:\"WASM-compatible\"}),\" browsers, so ensure your Dapp runs on a browser optimized for WASM.\"]}),\"\\n\"]}),\"\\n\",t(o.h3,{id:\"references\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#references\",children:\"References\"})}),\"\\n\",n(o.ul,{children:[\"\\n\",n(o.li,{children:[\"\\n\",t(o.p,{children:t(o.strong,{children:t(o.a,{href:\"https://github.com/CocDap/staking-ui\",children:\"Example Staking UI Repository - Author: CocDap\"})})}),\"\\n\"]}),\"\\n\",n(o.li,{children:[\"\\n\",t(o.p,{children:t(o.strong,{children:t(o.a,{href:\"https://forum.polkadot.network/t/introducing-dedot-a-delightful-javascript-client-for-polkadot-substrate-based-blockchains/8956\",children:\"Introducing Dedot: A delightful JavaScript client for Polkadot& Substrate-based blockchains\"})})}),\"\\n\"]}),\"\\n\",n(o.li,{children:[\"\\n\",t(o.p,{children:t(o.strong,{children:t(o.a,{href:\"https://forum.polkadot.network/t/polkadot-provider-api-a-common-interface-for-building-decentralized-applications/4128\",children:\"Polkadot Provider API: a common interface for building decentralized applications\"})})}),\"\\n\"]}),\"\\n\",n(o.li,{children:[\"\\n\",t(o.p,{children:t(o.strong,{children:t(o.a,{href:\"https://forum.polkadot.network/t/smoldot-updates-threads/4471\",children:\"Smoldot updates threads\"})})}),\"\\n\"]}),\"\\n\",n(o.li,{children:[\"\\n\",t(o.p,{children:t(o.strong,{children:t(o.a,{href:\"https://github.com/smol-dot/smoldot\",children:\"smol-dot/smoldot - Lightweight client for Substrate-based chains\"})})}),\"\\n\"]}),\"\\n\",n(o.li,{children:[\"\\n\",t(o.p,{children:t(o.strong,{children:t(o.a,{href:\"https://www.parity.io/blog/introducing-substrate-connect\",children:\"Introducing Substrate Connect: Browser-Based Light Clients for Connecting to Substrate Chains | Parity Technologies\"})})}),\"\\n\"]}),\"\\n\"]}),\"\\n\",t(o.h3,{id:\"about-the-author-\",children:t(o.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#about-the-author-\",children:\"About the Author üëãüèª\"})}),\"\\n\",n(o.p,{children:[t(o.strong,{children:\"Bio\"}),\" : \",n(o.em,{children:[\"Harry Riddle, an undergraduate Web3 Developer focused on Blockchain and AI, is a member of the \",t(o.strong,{children:\"OpenGuild\"}),\" community in Vietnam.\"]})]}),\"\\n\",n(o.p,{children:[t(o.strong,{children:\"Contact info\"}),\" :\"]}),\"\\n\",n(o.ul,{children:[\"\\n\",n(o.li,{children:[\"\\n\",n(o.p,{children:[t(o.strong,{children:\"X/Twitter\"}),\" : \",t(o.a,{href:\"https://x.com/0xHarryNguyenVN\",children:\"0xHarryNguyenVN\"})]}),\"\\n\"]}),\"\\n\",n(o.li,{children:[\"\\n\",n(o.p,{children:[t(o.strong,{children:\"Telegram\"}),\" : \",t(o.a,{href:\"https://t.me/HarryRiddle\",children:\"@HarryRiddle\"})]}),\"\\n\"]}),\"\\n\",n(o.li,{children:[\"\\n\",n(o.p,{children:[t(o.strong,{children:\"Discord\"}),\" : \",t(o.a,{href:\"http://@harrynguyen2107\",children:\"@harrynguyen2107\"})]}),\"\\n\"]}),\"\\n\"]})]})}return{default:function(e={}){const{wrapper:n}=e.components||{};return n?t(n,{...e,children:t(_createMdxContent,{...e})}):_createMdxContent(e)}};","slugAsParams":"harry-riddle-how-to-integrate-a-light-client-in-decentralized-application-on-polkadot-network"},{"slug":"posts/hello-world","title":"Hello World","description":"This is our first blog","date":"2024-10-20T00:00:00.000Z","published":true,"body":"const{Fragment:n,jsx:t,jsxs:o}=arguments[0];function _createMdxContent(e){const i={a:\"a\",h2:\"h2\",p:\"p\",...e.components},{Callout:r}=i;return r||function(n,t){throw new Error(\"Expected \"+(t?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\")}(\"Callout\",!0),o(n,{children:[t(r,{type:\"danger\",children:t(i.p,{children:\"Welcome to my blog\"})}),\"\\n\",t(i.h2,{id:\"introduction\",children:t(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#introduction\",children:\"Introduction\"})}),\"\\n\",t(i.h2,{id:\"introduction-1\",children:t(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#introduction-1\",children:\"Introduction\"})}),\"\\n\",t(i.h2,{id:\"introduction-2\",children:t(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#introduction-2\",children:\"Introduction\"})}),\"\\n\",t(i.h2,{id:\"introduction-3\",children:t(i.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#introduction-3\",children:\"Introduction\"})})]})}return{default:function(n={}){const{wrapper:o}=n.components||{};return o?t(o,{...n,children:t(_createMdxContent,{...n})}):_createMdxContent(n)}};","slugAsParams":"hello-world"},{"slug":"posts/light-client-polkadot/light-client-polkadot","title":"Light Client in Polkadot Network","description":"Light Client - Substrate Connect provides a secure, minimalistic approach for Decentralized Applications on Polkadot, bypassing the need for full node installations.","date":"2024-11-28T17:00:00.000Z","published":true,"body":"const{Fragment:e,jsx:n,jsxs:l}=arguments[0];function _createMdxContent(r){const s={a:\"a\",annotation:\"annotation\",code:\"code\",em:\"em\",figure:\"figure\",h2:\"h2\",h3:\"h3\",h4:\"h4\",img:\"img\",li:\"li\",math:\"math\",mi:\"mi\",mo:\"mo\",mrow:\"mrow\",msub:\"msub\",ol:\"ol\",p:\"p\",pre:\"pre\",semantics:\"semantics\",span:\"span\",strong:\"strong\",ul:\"ul\",...r.components};return l(e,{children:[n(s.h2,{id:\"substrate-connect\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#substrate-connect\",children:\"Substrate Connect\"})}),\"\\n\",n(s.h3,{id:\"introduction\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#introduction\",children:\"Introduction\"})}),\"\\n\",n(s.p,{children:\"Blockchain interactions require communication with a Peer-to-Peer (P2P) network to validate transactions and generate new blocks. Polkadot, like other blockchains, relies on a network of nodes that powers its consensus mechanism.\"}),\"\\n\",n(s.p,{children:n(s.img,{src:\"https://d3lkc3n5th01x7.cloudfront.net/wp-content/uploads/2022/08/09222628/Polkadot-node-setup.png\",alt:\"align=center&caption=Peer-to-Peer Network&sourceTitle= Polkadot's Architecture&sourceURL=https://softtech-blog.weebly.com/outline-of-polkadot-architecture\"})}),\"\\n\",n(s.p,{children:\"To communicate between the decentralized application and a network node in Polkadot is through a JSON RPC protocol. Typically, there are 2 main ways to do this:\"}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[n(s.strong,{children:\"User-Controlled Nodes:\"}),\" The Dapp (decentralized application) connects to a node client which the users have installed and run on their machine. These nodes are extremely secure because the users fully control it, but to install and maintain them are quietly complicated as they must be active 24/7 and connect with network rapidly.\"]}),\"\\n\",l(s.li,{children:[n(s.strong,{children:\"Publicly-Accessible Nodes:\"}),\" There are several third-parties or platforms providing a publicly-accessible node client. These nodes are available every time when users need so they are more convenient to interact. However, their drawbacks are insecure and centralized because they are controlled by their owner.\"]}),\"\\n\"]}),\"\\n\",l(s.p,{children:[n(s.strong,{children:n(s.a,{href:\"https://substrate.io/substrate-connect/\",children:\"Substrate Connect\"})}),\", on the other hand, is introduced for decentralized application to minimally connect to Polkadot network instead of utilizing a centralized RPC node but still securely.\"]}),\"\\n\",n(s.h3,{id:\"substate-connect--the-perfect-alternative-for-substrate-smoldot\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#substate-connect--the-perfect-alternative-for-substrate-smoldot\",children:\"Substate Connect & The perfect alternative for Substrate: Smoldot\"})}),\"\\n\",l(s.p,{children:[\"Firstly, \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/substrate\",children:\"Substrate\"})}),\" was ever one of the core repositories in the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/polkadot-sdk\",children:\"Polkadot SDK\"})}),\" to help everyone to build the unique Blockchain on the Polkadot. However, it was merged with two repositories Cumulus and Polkadot into a new repository: \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/polkadot-sdk\",children:\"the Polkadot SDK\"})}),\". From here, \",n(s.strong,{children:n(s.a,{href:\"https://github.com/smol-dot/smoldot\",children:\"Smoldot\"})}),\" is introduced as an alternative client of \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/substrate\",children:\"Substrate\"})}),\"-based chain.\"]}),\"\\n\",l(s.p,{children:[n(s.strong,{children:\"Smoldot\"}),\" validates the submitted transactions (from users) before sending to full nodes (centralized nodes) by itself to add those transactions to the transaction pool. \",n(s.strong,{children:\"Substrate Connect\"}),\" provides the infrastructure necessary to run \",n(s.strong,{children:\"light clients\"}),\" directly in the browsers. By default, \",n(s.strong,{children:\"Substrate Connect\"}),\" runs in the browser independently with each browser tab, install the browser extension to enable resource sharing among browser tabs. With \",n(s.strong,{children:\"Substrate Connect\"}),\", there‚Äôs no need for a centralized RPC node; it operates like a bridge, running \",n(s.strong,{children:n(s.a,{href:\"https://github.com/smol-dot/smoldot\",children:\"Smoldot\"})}),\" in the browser extension making it possible for every tabs or website to sync with the chain.\"]}),\"\\n\",l(s.p,{children:[\"Abstractly, \",n(s.strong,{children:\"Smoldot\"}),\" is used to interact with the \",n(s.strong,{children:\"relay chain\"}),\" or a \",n(s.strong,{children:\"parachain\"}),\", it always needs to sync with the relay chain. What about for a parachain? The parachain's finalized state is guaranteed on the relay chain. To verify whether a relay chain block is finalized, the light client needs to know the \",n(s.strong,{children:\"elected validators\"}),\" from the \",n(s.strong,{children:\"GRANDPA\"}),\" protocol. \",l(s.strong,{children:[n(s.a,{href:\"https://github.com/w3f/consensus/blob/master/pdf/grandpa.pdf\",children:\"GRANDPA\"}),\" (GHOST-based Recursive ANcestor Deriving Prefix Agreement)\"]}),\" is the finality gadget that is implemented for the relay chain. The \",n(s.strong,{children:\"Polkadot Host\"}),\" uses the \",n(s.strong,{children:\"GRANDPA\"}),\" finality protocol to finality blocks. The condition for Smoldot to set the block finalized is that more than \",n(s.strong,{children:\"2/3\"}),\" of the validators nodes voted \",n(s.strong,{children:\"FOR\"}),\" on the block and the signatures are correct. Polkadot uses \",n(s.strong,{children:\"NPoS (Nominated Proof-of-Stake)\"}),\" as its mechanism for selecting the validator set. Changes authority set or validator set are crucial to track for a node who tries to sync with the relay chain in order to verify justifications. The speed up way to sync which its proposed is \",n(s.strong,{children:n(s.a,{href:\"https://spec.polkadot.network/chap-networking#sect-msg-warp-sync\",children:\"warp sync\"})}),\". Instead of downloading the entire chain as the \",n(s.strong,{children:n(s.a,{href:\"https://spec.polkadot.network/chap-sync#id-full-sync\",children:\"full sync protocol\"})}),\" or downloading the block header history and validating the authority set changes like \",n(s.strong,{children:n(s.a,{href:\"https://spec.polkadot.network/chap-sync#sect-sync-fast\",children:\"fast sync\"})}),\" , it only downloads the block headers where authority set changes occurred and this things are called \",n(s.strong,{children:\"fragments\"}),\". These fragments form the arrays and concat with the boolean value indicating whether the warp sync has been completed as the below format:\"]}),\"\\n\",l(\"div\",{className:\"flex flex-col items-center space-y-2\",children:[n(\"span\",{className:\"text-4xl\",children:l(s.span,{className:\"katex\",children:[n(s.span,{className:\"katex-mathml\",children:n(s.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:l(s.semantics,{children:[l(s.mrow,{children:[n(s.mi,{children:\"P\"}),n(s.mo,{children:\"=\"}),n(s.mo,{stretchy:\"false\",children:\"(\"}),l(s.msub,{children:[n(s.mi,{children:\"f\"}),n(s.mi,{children:\"x\"})]}),n(s.mi,{mathvariant:\"normal\",children:\".\"}),n(s.mi,{mathvariant:\"normal\",children:\".\"}),n(s.mi,{mathvariant:\"normal\",children:\".\"}),l(s.msub,{children:[n(s.mi,{children:\"f\"}),n(s.mi,{children:\"y\"})]}),n(s.mo,{separator:\"true\",children:\",\"}),n(s.mi,{children:\"c\"}),n(s.mo,{stretchy:\"false\",children:\")\"})]}),n(s.annotation,{encoding:\"application/x-tex\",children:\" P = (f_{x}...f_{y},c)\"})]})})}),l(s.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:[l(s.span,{className:\"base\",children:[n(s.span,{className:\"strut\",style:{height:\"0.6833em\"}}),n(s.span,{className:\"mord mathnormal\",style:{marginRight:\"0.13889em\"},children:\"P\"}),n(s.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}}),n(s.span,{className:\"mrel\",children:\"=\"}),n(s.span,{className:\"mspace\",style:{marginRight:\"0.2778em\"}})]}),l(s.span,{className:\"base\",children:[n(s.span,{className:\"strut\",style:{height:\"1.0361em\",verticalAlign:\"-0.2861em\"}}),n(s.span,{className:\"mopen\",children:\"(\"}),l(s.span,{className:\"mord\",children:[n(s.span,{className:\"mord mathnormal\",style:{marginRight:\"0.10764em\"},children:\"f\"}),n(s.span,{className:\"msupsub\",children:l(s.span,{className:\"vlist-t vlist-t2\",children:[l(s.span,{className:\"vlist-r\",children:[n(s.span,{className:\"vlist\",style:{height:\"0.1514em\"},children:l(s.span,{style:{top:\"-2.55em\",marginLeft:\"-0.1076em\",marginRight:\"0.05em\"},children:[n(s.span,{className:\"pstrut\",style:{height:\"2.7em\"}}),n(s.span,{className:\"sizing reset-size6 size3 mtight\",children:n(s.span,{className:\"mord mtight\",children:n(s.span,{className:\"mord mathnormal mtight\",children:\"x\"})})})]})}),n(s.span,{className:\"vlist-s\",children:\"‚Äã\"})]}),n(s.span,{className:\"vlist-r\",children:n(s.span,{className:\"vlist\",style:{height:\"0.15em\"},children:n(s.span,{})})})]})})]}),n(s.span,{className:\"mord\",children:\"...\"}),l(s.span,{className:\"mord\",children:[n(s.span,{className:\"mord mathnormal\",style:{marginRight:\"0.10764em\"},children:\"f\"}),n(s.span,{className:\"msupsub\",children:l(s.span,{className:\"vlist-t vlist-t2\",children:[l(s.span,{className:\"vlist-r\",children:[n(s.span,{className:\"vlist\",style:{height:\"0.1514em\"},children:l(s.span,{style:{top:\"-2.55em\",marginLeft:\"-0.1076em\",marginRight:\"0.05em\"},children:[n(s.span,{className:\"pstrut\",style:{height:\"2.7em\"}}),n(s.span,{className:\"sizing reset-size6 size3 mtight\",children:n(s.span,{className:\"mord mtight\",children:n(s.span,{className:\"mord mathnormal mtight\",style:{marginRight:\"0.03588em\"},children:\"y\"})})})]})}),n(s.span,{className:\"vlist-s\",children:\"‚Äã\"})]}),n(s.span,{className:\"vlist-r\",children:n(s.span,{className:\"vlist\",style:{height:\"0.2861em\"},children:n(s.span,{})})})]})})]}),n(s.span,{className:\"mpunct\",children:\",\"}),n(s.span,{className:\"mspace\",style:{marginRight:\"0.1667em\"}}),n(s.span,{className:\"mord mathnormal\",children:\"c\"}),n(s.span,{className:\"mclose\",children:\")\"})]})]})]})}),l(\"div\",{className:\"w-auto flex flex-col justify-center\",children:[l(\"span\",{children:[n(s.strong,{children:l(s.span,{className:\"katex\",children:[n(s.span,{className:\"katex-mathml\",children:n(s.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:l(s.semantics,{children:[l(s.mrow,{children:[l(s.msub,{children:[n(s.mi,{children:\"f\"}),n(s.mi,{children:\"x\"})]}),n(s.mi,{mathvariant:\"normal\",children:\".\"}),n(s.mi,{mathvariant:\"normal\",children:\".\"}),n(s.mi,{mathvariant:\"normal\",children:\".\"}),l(s.msub,{children:[n(s.mi,{children:\"f\"}),n(s.mi,{children:\"y\"})]})]}),n(s.annotation,{encoding:\"application/x-tex\",children:\"f_{x}...f_{y}\"})]})})}),n(s.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:l(s.span,{className:\"base\",children:[n(s.span,{className:\"strut\",style:{height:\"0.9805em\",verticalAlign:\"-0.2861em\"}}),l(s.span,{className:\"mord\",children:[n(s.span,{className:\"mord mathnormal\",style:{marginRight:\"0.10764em\"},children:\"f\"}),n(s.span,{className:\"msupsub\",children:l(s.span,{className:\"vlist-t vlist-t2\",children:[l(s.span,{className:\"vlist-r\",children:[n(s.span,{className:\"vlist\",style:{height:\"0.1514em\"},children:l(s.span,{style:{top:\"-2.55em\",marginLeft:\"-0.1076em\",marginRight:\"0.05em\"},children:[n(s.span,{className:\"pstrut\",style:{height:\"2.7em\"}}),n(s.span,{className:\"sizing reset-size6 size3 mtight\",children:n(s.span,{className:\"mord mtight\",children:n(s.span,{className:\"mord mathnormal mtight\",children:\"x\"})})})]})}),n(s.span,{className:\"vlist-s\",children:\"‚Äã\"})]}),n(s.span,{className:\"vlist-r\",children:n(s.span,{className:\"vlist\",style:{height:\"0.15em\"},children:n(s.span,{})})})]})})]}),n(s.span,{className:\"mord\",children:\"...\"}),l(s.span,{className:\"mord\",children:[n(s.span,{className:\"mord mathnormal\",style:{marginRight:\"0.10764em\"},children:\"f\"}),n(s.span,{className:\"msupsub\",children:l(s.span,{className:\"vlist-t vlist-t2\",children:[l(s.span,{className:\"vlist-r\",children:[n(s.span,{className:\"vlist\",style:{height:\"0.1514em\"},children:l(s.span,{style:{top:\"-2.55em\",marginLeft:\"-0.1076em\",marginRight:\"0.05em\"},children:[n(s.span,{className:\"pstrut\",style:{height:\"2.7em\"}}),n(s.span,{className:\"sizing reset-size6 size3 mtight\",children:n(s.span,{className:\"mord mtight\",children:n(s.span,{className:\"mord mathnormal mtight\",style:{marginRight:\"0.03588em\"},children:\"y\"})})})]})}),n(s.span,{className:\"vlist-s\",children:\"‚Äã\"})]}),n(s.span,{className:\"vlist-r\",children:n(s.span,{className:\"vlist\",style:{height:\"0.2861em\"},children:n(s.span,{})})})]})})]})]})})]})}),\":  is an array consisting of warp sync fragments.\"]}),l(\"span\",{children:[n(s.strong,{children:l(s.span,{className:\"katex\",children:[n(s.span,{className:\"katex-mathml\",children:n(s.math,{xmlns:\"http://www.w3.org/1998/Math/MathML\",children:l(s.semantics,{children:[n(s.mrow,{children:n(s.mi,{children:\"c\"})}),n(s.annotation,{encoding:\"application/x-tex\",children:\"c\"})]})})}),n(s.span,{className:\"katex-html\",\"aria-hidden\":\"true\",children:l(s.span,{className:\"base\",children:[n(s.span,{className:\"strut\",style:{height:\"0.4306em\"}}),n(s.span,{className:\"mord mathnormal\",children:\"c\"})]})})]})}),\":  is the boolean indicates whether the warp sync has been completed.\"]})]})]}),\"\\n\",l(s.p,{children:[\"When it is up to date with the latest \",n(s.strong,{children:\"GRANDPA\"}),\", Smoldot will start syncing with the chain similar to a full node. Smoldot only retrieve new block headers and verify by verifying the \",n(s.strong,{children:\"authenticity\"}),\" of those blocks. In addition, Polkadot also uses the \",n(s.strong,{children:\"BABE protocol\"}),\" to produce the new blocks. \",n(s.strong,{children:\"BABE (Blind Assignmnent for Blockchain Extension)\"}),\" is the block production mechanism that runs between the validator nodes and determines the author or the owner of new blocks. After Smoldot verifies th block header, whether the author of the block was selected by \",n(s.strong,{children:\"BABE\"}),\" protocol. Practically, BABE separate into many epochs, with each epochs being divided into \",n(s.strong,{children:\"slots\"}),\". All slots in each epoch are sequentially indexed starting from 0. At the beginning of each epoch, the BABE needs to run the \",n(s.strong,{children:n(s.a,{href:\"https://spec.polkadot.network/sect-block-production#algo-block-production-lottery\",children:\"Block Production Lottery\"})}),\" to find out which slots it should produce a block and gossip to the other block producers.\"]}),\"\\n\",l(s.p,{children:[\"Finally, Smoldot verifies the \",n(s.strong,{children:\"consensus\"}),\" and the finality by tracking consecutively the authority set. The authority set will be obtained through the runtime when it updates the chain  it acquires subsequent changes from the block headers.\"]}),\"\\n\",n(s.h3,{id:\"what-does-smoldot-need-to-run-\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#what-does-smoldot-need-to-run-\",children:\"What does Smoldot need to run ?\"})}),\"\\n\",l(s.p,{children:[\"In order to start syncing with a chain, the Smoldot requires the list of information called \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/chain_spec.rs#L18-L34\",children:\"chainspec\"})}),\". A chain specification is the description of everything related the chain being desired connected and required for the client to successfully interact with that chain. The chainspec only consists of \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/main/src/chain_spec/structs.rs#L33\",children:\"clientspec\"})}),\" that look like as the following structure:\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#F97583\"},children:\"...\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"#[derive(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Serialize\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Deserialize\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Debug\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")]\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"#[serde(rename_all \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:' \"camelCase\"'}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")]\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"#[serde(deny_unknown_fields)]\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") \"}),n(s.span,{style:{color:\"#F97583\"},children:\"struct\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" ClientSpec\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") name\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" String\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") id\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" String\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    #[serde(default)]\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") chain_type\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" ChainType\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    #[serde(default)]\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") code_substitutes\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" HashMap\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"u64\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"HexString\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", fnv\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"FnvBuildHasher\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") boot_nodes\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Vec\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"String\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") telemetry_endpoints\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Vec\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"String\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"u8\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")>>,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") protocol_id\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"String\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    \"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"    #[serde(default \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:' \"Default::default\"'}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", skip_serializing_if \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:' \"Option::is_none\"'}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")]\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") fork_id\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"String\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    \"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"    #[serde(default \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:' \"Default::default\"'}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", skip_serializing_if \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:' \"Option::is_none\"'}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")]\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") block_number_bytes\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"u8\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") properties\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Box\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<serde_json\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"value\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"RawValue\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">>,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") fork_blocks\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Vec\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"u64\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"HashHexString\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")>>,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") bad_blocks\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"HashSet\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"HashHexString\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"FnvBuildHasher\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">>,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    \"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    #[serde(default, skip_serializing)]\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    #[allow(unused)]\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") consensus_engine\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") genesis\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Genesis\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") light_sync_state\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"LightSyncState\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    \"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    #[serde(flatten)]\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"super\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") parachain\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"ChainSpecParachain\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"}\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#F97583\"},children:\"...\"})})]})})}),\"\\n\",l(s.p,{children:[\"From the chainspec, the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/Daanvdplas/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/chain/chain_information.rs#L118-L129\",children:\"chain information\"})}),\" is built. As we can see in the code, the chain information is all the crucial information Smoldot requires to verify the consensus and finality. It will be constructed from either:\"]}),\"\\n\",l(s.ul,{children:[\"\\n\",n(s.li,{children:\"The genesis state\"}),\"\\n\",l(s.li,{children:[\"The \",n(s.strong,{children:n(s.a,{href:\"https://github.com/Daanvdplas/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/chain_spec/light_sync_state.rs#L65\",children:\"checkpoint\"})})]}),\"\\n\",n(s.li,{children:\"From the database\"}),\"\\n\"]}),\"\\n\",n(s.p,{children:\"As a result, the chain information provides the starting authority set for the warp sync process.\"}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"#[derive(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Debug\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")]\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"pub\"}),n(s.span,{style:{color:\"#F97583\"},children:\" struct\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" ChainInformation\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"    /// Header of the highest known finalized block.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",\"data-highlighted-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" finalized_block_header\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" header\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Header\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"    /// Extra items that depend on the consensus engine.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",\"data-highlighted-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" consensus\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" ChainInformationConsensus\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"    /// Extra items that depend on the finality engine.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",\"data-highlighted-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" finality\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" ChainInformationFinality\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"}\"})})]})})}),\"\\n\",n(s.p,{children:\"However, to sync with a chain it needs much more information like that. It requires the information from other peers and therefore needs to join the peer-to-peer network.\"}),\"\\n\",n(s.h3,{id:\"networking\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#networking\",children:\"Networking\"})}),\"\\n\",n(s.p,{children:n(s.img,{src:\"https://i.imgur.com/5LcReWd.png\",alt:\"size=medium&caption=Networking Service&alt=Networking Service&sourceTitle=Smoldot: Hello world!&sourceURL=https://hackmd.io/@s_iGZLIITG6WjSgnFX0pcg/rkmmcvBno\"})}),\"\\n\",l(s.p,{children:[\"First of all, in order to connect to other nodes Smoldot needs the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/bin/light-base/src/network_service.rs#L18-L37\",children:\"networking service\"})}),\". It's responsible to try stay connected as much as possible to the nodes of the peer-to-peer network of the chain and maintain open substreams with them in order to send out requests and notifications. The network service will create on background task for each active connection. There are 3 background tasks, the network service needs to start:\"]}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"Process the network service (main task). \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/bin/light-base/src/network_service.rs#L282\",children:\"Source code\"})})]}),\"\\n\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"(config\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"tasks_executor)(\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#9ECBFF\"},children:'  \"network-service\"'}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"into\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"  Box\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"pin\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"({\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"      let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" shared \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" shared\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"      let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" future \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" background_task\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(shared, event_senders);\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"      let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (abortable, abort_handle) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" future\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"abortable\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(future);\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"      abort_handles\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"push\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(abort_handle);\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"      abortable\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"map\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"_\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" ())\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"  }),\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\");\"})})]})})}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"Network discovery (done through a separate task). \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/bin/light-base/src/network_service.rs#L296\",children:\"Source code\"})})]}),\"\\n\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"(config\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"tasks_executor)(\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#9ECBFF\"},children:'  \"network-discovery\"'}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"into\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"  Box\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"pin\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"({\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"      let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" shared \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" shared\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"      let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" future \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#F97583\"},children:\" async\"}),n(s.span,{style:{color:\"#F97583\"},children:\" move\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"          let\"}),n(s.span,{style:{color:\"#F97583\"},children:\" mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" next_discovery \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Duration\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"from_secs\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"5\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"          loop\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"              TPlat\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"sleep\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(next_discovery)\"}),n(s.span,{style:{color:\"#F97583\"},children:\".await\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"              next_discovery \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" cmp\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"min\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(next_discovery \"}),n(s.span,{style:{color:\"#F97583\"},children:\"*\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" 2\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Duration\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"from_secs\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"120\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"));\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"              let\"}),n(s.span,{style:{color:\"#F97583\"},children:\" mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" guarded \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" shared\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"guarded\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"lock\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"}),n(s.span,{style:{color:\"#F97583\"},children:\".await\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"              for\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" chain_index \"}),n(s.span,{style:{color:\"#F97583\"},children:\"in\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" 0\"}),n(s.span,{style:{color:\"#F97583\"},children:\"..\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"shared\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"log_chain_names\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"len\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"() {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                  let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" operation_id \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" guarded\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                      .\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"network\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                      .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"start_kademlia_discovery_round\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"TPlat\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"now\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(), chain_index);\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                  let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" _prev_value \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" guarded\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                      .\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"kademlia_discovery_operations\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                      .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"insert\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(operation_id, chain_index);\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"                  debug_assert!\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(_prev_value\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"is_none\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"              }\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"              shared\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"wake_up_main_background_task\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"notify\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"1\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\");\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"          }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"      };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"      let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (abortable, abort_handle) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" future\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"abortable\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(future);\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"      abort_handles\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"push\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(abort_handle);\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"      abortable\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"map\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"_\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" ())\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"  }),\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\");\"})})]})})}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"Process existing connections. \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/bin/light-base/src/network_service.rs#L332\",children:\"Source code\"})})]}),\"\\n\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"(config\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"tasks_executor)(\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#9ECBFF\"},children:'  \"connections\"'}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"into\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"  Box\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"pin\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"({\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"      let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" future \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#F97583\"},children:\" async\"}),n(s.span,{style:{color:\"#F97583\"},children:\" move\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"          let\"}),n(s.span,{style:{color:\"#F97583\"},children:\" mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" connections \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" stream\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"FuturesUnordered\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"          loop\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"              futures\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"select!\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                  new_connec \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" new_tasks_rx\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"select_next_some\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                      connections\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"push\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(new_connec);\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"                  },\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                  () \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" connections\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"select_next_some\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {},\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"              }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"          }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"      };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"      let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (abortable, abort_handle) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" future\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"abortable\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(future);\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"      abort_handles\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"push\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(abort_handle);\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"      abortable\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"map\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"_\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" ())\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"  }),\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\");\"})})]})})}),\"\\n\",n(s.h4,{id:\"processing-the-networking-service\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#processing-the-networking-service\",children:\"Processing the networking service\"})}),\"\\n\",l(s.p,{children:[\"This task is the main task in execution task of Smoldot. It ensures the objective of the Networking Service as we mentioned that Smoldot is always connected to the peer-to-peer network. The amount of \",n(s.code,{children:\"in-slots\"}),\" and \",n(s.code,{children:\"out-slots\"}),\" refer, to the maximum amount of peers that can connect to Smoldot and the maximum amount of peers Smoldot connect to. In the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/main/bin/full-node/src/run/network_service.rs#L222\",children:\"full node\"})}),\", the number of\\r\\n\",n(s.strong,{children:\"in_slots\"}),\" and \",n(s.strong,{children:\"out_slots\"}),\" is 25 for each. However, the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/main/bin/light-base/src/network_service.rs#L218\",children:\"light node\"})}),\" only has 3 for \",n(s.strong,{children:\"in_slots\"}),\" and the \",n(s.strong,{children:\"out_slots\"}),\" is 4. Smoldot uses the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/libp2p/collection.rs#L18-L48\",children:\"libp2p protocol\"})}),\" to coordinates the requests and responses from the connections to Smoldot and vice versa.\"]}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"Assign \",n(s.strong,{children:\"out_slots\"}),\":\"]}),\"\\n\"]}),\"\\n\",l(s.p,{children:[\"Only the maximum number of slots is not reached and that peers have not had a slot yet, the combinations of notifications protocol and peers will be marked as \",n(s.strong,{children:'\"desired\"'}),\". In addition, it inserts that peer to \",n(s.strong,{children:\"out_peers\"}),\" in \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/main/src/network/service.rs#L110\",children:\"ChainConfig\"})}),\". (The \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/main/src/network/service.rs#L1088\",children:\"assign_out_slot\"})}),\" occurs in \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/bin/light-base/src/network_service.rs#L1327\",children:\"update_round process\"})}),\")\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"  pub\"}),n(s.span,{style:{color:\"#F97583\"},children:\" fn\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" assign_out_slot\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&mut\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", chain_index\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" usize\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", peer_id\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" PeerId\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" chain \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#F97583\"},children:\" &mut\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"chains[chain_index];\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // Check if maximum number of slots is reached.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        if\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" chain\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"out_peers\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"len\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            >=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" usize\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"try_from\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(chain\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"chain_config\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"out_slots)\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"unwrap_or\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"usize\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"max_value\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"())\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        {\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            return\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"; \"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // Don't assign slots to peers that already have a slot.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        if\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" chain\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"out_peers\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"contains\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"peer_id) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"||\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" chain\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"in_peers\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"contains\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"peer_id) {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            return\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"; \"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#79B8FF\"},children:\"        self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"inner\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"set_peer_notifications_out_desired\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            &\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"peer_id,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"            chain_index \"}),n(s.span,{style:{color:\"#F97583\"},children:\"*\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" NOTIFICATIONS_PROTOCOLS_PER_CHAIN\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            peers\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"DesiredState\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"DesiredReset\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        );\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"        chain\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"out_peers\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"insert\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(peer_id);\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})})]})})}),\"\\n\",l(s.ul,{children:[\"\\n\",n(s.li,{children:\"Start new connections with desired peers:\"}),\"\\n\"]}),\"\\n\",n(s.p,{children:\"After all peer assignments, the list of connections should be opened.\"}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    loop\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" start_connect \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#F97583\"},children:\" match\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" guarded\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"network\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"next_start_connect\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"||\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" TPlat\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"now\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()) {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            Some\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(sc) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" sc,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            None\"}),n(s.span,{style:{color:\"#F97583\"},children:\" =>\"}),n(s.span,{style:{color:\"#F97583\"},children:\" break\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" is_important \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" guarded\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            .\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"important_nodes\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"contains\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"start_connect\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"expected_peer_id);\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // Perform the connection process in a separate task.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" task \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" tasks\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"connection_task\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"            start_connect,\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"            shared\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"            guarded\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"messages_from_connections_tx\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"            is_important,\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        );\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // Sending the new task might fail in case a shutdown is happening, in which case\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // we don't really care about the state of anything anymore.\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // The sending here is normally very quick.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" _ \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" guarded\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"new_tasks_tx\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"send\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Box\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"pin\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(task))\"}),n(s.span,{style:{color:\"#F97583\"},children:\".await\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\";\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})})]})})}),\"\\n\",l(s.p,{children:[n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/main/src/network/service.rs#L997\",children:\"During starting connections\"})}),\", the API user muse give that they use \",n(s.strong,{children:\"single stream\"}),\" or \",n(s.strong,{children:\"multi stream\"}),\" to report how connection attempt went.\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#F97583\"},children:\" fn\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" next_start_connect\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&mut\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", now\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#F97583\"},children:\" impl\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" FnOnce\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"() \"}),n(s.span,{style:{color:\"#F97583\"},children:\"->\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" TNow\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") \"}),n(s.span,{style:{color:\"#F97583\"},children:\"->\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"StartConnect\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"TNow\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">> {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // Ask the underlying state machine which nodes are desired but don't have any\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // associated connection attempt yet.\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // Since the underlying state machine is only made aware of connections when\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // `pending_outcome_ok` is reached, we must filter out nodes that already have an\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // associated `PendingId`.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" unfulfilled_desired_peers \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"inner\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"unfulfilled_desired_peers\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        for\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" peer_id \"}),n(s.span,{style:{color:\"#F97583\"},children:\"in\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" unfulfilled_desired_peers {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"            // TODO: allow more than one simultaneous dial per peer, and distribute the dials so that we don't just return the same peer multiple times in a row while there are other peers waiting\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" entry \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#F97583\"},children:\" match\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"num_pending_per_peer\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"entry\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(peer_id\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()) {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"                hashbrown\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"hash_map\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Entry\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Occupied\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(_) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#F97583\"},children:\" continue\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"                hashbrown\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"hash_map\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Entry\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Vacant\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(entry) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" entry,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"            };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" multiaddr\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" multiaddr\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Multiaddr\"}),n(s.span,{style:{color:\"#F97583\"},children:\" =\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" potential \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                    .\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"chains\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                    .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"iter_mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                    .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"flat_map\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"chain\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" chain\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"kbuckets\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"iter_mut_ordered\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"())\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                    .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"find\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(p, _)\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#F97583\"},children:\" **\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"p \"}),n(s.span,{style:{color:\"#F97583\"},children:\"==\"}),n(s.span,{style:{color:\"#F97583\"},children:\" *\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"entry\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"key\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"())\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                    .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"and_then\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(peer_id, _)\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#79B8FF\"},children:\"                        self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"kbuckets_peers\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                            .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"get_mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(peer_id)\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                            .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"unwrap\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                            .\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"addresses\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                            .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"addr_to_pending\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"                    });\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                match\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" potential {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"                    Some\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(a) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" a\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"                    None\"}),n(s.span,{style:{color:\"#F97583\"},children:\" =>\"}),n(s.span,{style:{color:\"#F97583\"},children:\" continue\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"                }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"            };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" now \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" now\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" pending_id \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" PendingId\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"pending_ids\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"insert\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"((\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                entry\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"key\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                multiaddr\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                now\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"            )));\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" start_connect \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" StartConnect\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                expected_peer_id\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" entry\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"key\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                id\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" pending_id,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"                multiaddr,\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                timeout\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" now \"}),n(s.span,{style:{color:\"#F97583\"},children:\"+\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"handshake_timeout,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"            };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"            entry\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"insert\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"NonZeroUsize\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"1\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"unwrap\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            return\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Some\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(start_connect);\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#B392F0\"},children:\"        None\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})})]})})}),\"\\n\",n(s.p,{children:\"After creating connections, Smoldot perform the connection process in a separate task\"}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"1\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"  let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" task \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" tasks\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"connection_task\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"      start_connect,\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"      shared\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"      guarded\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"messages_from_connections_tx\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"clone\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"      is_important,\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"  );\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"  let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" _ \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" guarded\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"new_tasks_tx\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"send\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Box\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"pin\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(task))\"}),n(s.span,{style:{color:\"#F97583\"},children:\".await\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\";\"})]})]})})}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:\"The coordinator is updated about the connectivity status with a give peer. It's responsible for distributing it to the right service.\"}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:\"Process requests and updates from other services:\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(s.p,{children:\"Smoldot pulls the messages that the coordinator has generated in destination to the various connections and sends that messages to the active connections.\"}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    loop\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (connection_id, message) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#F97583\"},children:\" match\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" guarded\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"network\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"pull_message_to_connection\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"() {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            Some\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(m) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" m,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            None\"}),n(s.span,{style:{color:\"#F97583\"},children:\" =>\"}),n(s.span,{style:{color:\"#F97583\"},children:\" break\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // Note that it is critical for the sending to not take too long here, in order to not\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // block the process of the network service.\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // In particular, if sending the message to the connection is blocked due to sending\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // a message on the connection-to-coordinator channel, this will result in a deadlock.\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // For this reason, the connection task is always ready to immediately accept a message\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // on the coordinator-to-connection channel.\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        guarded\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            .\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"active_connections\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"get_mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"connection_id)\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"unwrap\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"send\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(message)\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#F97583\"},children:\"            .await\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"unwrap\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"();\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})})]})})}),\"\\n\",n(s.h4,{id:\"network-discovery\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#network-discovery\",children:\"Network discovery\"})}),\"\\n\",l(s.p,{children:[\"In a peer-to-peer network, it's necessary to have the information of the connection to connect to any given peer, available at any given time. To make this information decentralized, Smoldot need to divide it over all the peers through the \",n(s.strong,{children:n(s.a,{href:\"https://docs.ipfs.tech/concepts/dht/#distributed-hash-tables-dhts\",children:\"Kademlia Distributed Hash Tables\"})}),\". It's a distributed system for mapping keys to values in IPFS. Each information or data in IPFS would be hashed to get its digest and with each data changes the hash digest would be changed as well.\"]}),\"\\n\",l(s.p,{children:[\"In the \",n(s.strong,{children:\"Distributed hash table\"}),\", each node was called \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/network/kademlia/kbuckets.rs#L18-L67\",children:\"k-buckets\"})}),\", which make a partial view of the complete list of all the peers in the network.\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"1\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#F97583\"},children:\" struct\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" KBuckets\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"K\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"V\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"TNow\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#F97583\"},children:\"const\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" ENTRIES_PER_BUCKET\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" usize\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"> {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:'        /// Key of the \"local\" node, that holds the buckets.'})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"        local_key\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"K\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Key\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"),\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        /// List of buckets, ordered by increasing distance. In other words, the first elements of\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        /// this field are the ones that are the closest to [`KBuckets::local_key`].\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"        buckets\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Vec\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Bucket\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"K\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"V\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"TNow\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#B392F0\"},children:\"ENTRIES_PER_BUCKET\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\">>,\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        /// Duration after which the last entry of each bucket will expired if it is disconnected.\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"        pending_timeout\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Duration\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})})]})})}),\"\\n\",l(s.p,{children:[\"The objective of Network discovery is that sending a \",n(s.strong,{children:\"Kademlia\"}),' \"find node\" request to single peer. Moreover,\\r\\nSmoldot based on the ',n(s.strong,{children:n(s.a,{href:\"https://github.com/libp2p/specs/tree/master/kad-dht#rpc-messages\",children:\"Kademlia request-response protocol\"})}),\" to build a wire message to get the nodes closest to the parameters. The following steps is to decide which peer it sends the request message:\"]}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"Creating a Sha256 hash digest from the a random created peerID (\",n(s.code,{children:\"local_key\"}),\"), the target hash.\"]}),\"\\n\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#F97583\"},children:\" fn\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(local_key\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" K\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", pending_timeout\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Duration\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") \"}),n(s.span,{style:{color:\"#F97583\"},children:\"->\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" Self\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" local_key_hashed \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Key\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(local_key\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"as_ref\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"        KBuckets\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"            local_key\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (local_key, local_key_hashed),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"            buckets\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"0\"}),n(s.span,{style:{color:\"#F97583\"},children:\"..\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"256\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"map\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"_\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Bucket\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                    entries\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" arrayvec\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"ArrayVec\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                    num_connected_entries\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" 0\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"                    pending_entry\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" None\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"                })\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"                .\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"collect\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(),\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"            pending_timeout,\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})})]})})}),\"\\n\",l(s.ul,{children:[\"\\n\",n(s.li,{children:\"Finding out the k-buckets for the closest peers\"}),\"\\n\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#F97583\"},children:\" fn\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" get\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"self\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", key\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#F97583\"},children:\" &\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"K\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") \"}),n(s.span,{style:{color:\"#F97583\"},children:\"->\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"V\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"> {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" key_hashed \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Key\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(key\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"as_ref\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" distance \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#F97583\"},children:\" match\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" distance_log2\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"local_key\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"1\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"key_hashed) {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            Some\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(d) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" d,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            None\"}),n(s.span,{style:{color:\"#F97583\"},children:\" =>\"}),n(s.span,{style:{color:\"#F97583\"},children:\" return\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" None\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#79B8FF\"},children:\"        self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"buckets[\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"usize\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"from\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(distance)]\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"get\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(key)\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#F97583\"},children:\" fn\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" get_mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&mut\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", key\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#F97583\"},children:\" &\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"K\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") \"}),n(s.span,{style:{color:\"#F97583\"},children:\"->\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Option\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&mut\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" V\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"> {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" key_hashed \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Key\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(key\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"as_ref\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" distance \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#F97583\"},children:\" match\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" distance_log2\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"local_key\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"1\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"key_hashed) {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            Some\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(d) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=>\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" d,\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            None\"}),n(s.span,{style:{color:\"#F97583\"},children:\" =>\"}),n(s.span,{style:{color:\"#F97583\"},children:\" return\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" None\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\",\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        };\"})}),\"\\n\",n(s.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#79B8FF\"},children:\"        self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"buckets[\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"usize\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"from\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(distance)]\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"get_mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(key)\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})})]})})}),\"\\n\",l(s.ul,{children:[\"\\n\",n(s.li,{children:\"Hashing the peerIDs of closest peers and sorting its list with ascending order of the log2 distance between the target hash and the k-bucket peer's hash.\"}),\"\\n\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",children:l(s.code,{\"data-line-numbers\":\"\",\"data-language\":\"rs\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},\"data-line-numbers-max-digits\":\"2\",children:[l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"    pub\"}),n(s.span,{style:{color:\"#F97583\"},children:\" fn\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" closest_entries\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"self\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", target\"}),n(s.span,{style:{color:\"#F97583\"},children:\":\"}),n(s.span,{style:{color:\"#F97583\"},children:\" &\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"K\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\") \"}),n(s.span,{style:{color:\"#F97583\"},children:\"->\"}),n(s.span,{style:{color:\"#F97583\"},children:\" impl\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Iterator\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Item\"}),n(s.span,{style:{color:\"#F97583\"},children:\" =\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" (\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"K\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"V\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")> {\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#6A737D\"},children:\"        // TODO: this is extremely unoptimized\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" target_hashed \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Key\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(target\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"as_ref\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"        let\"}),n(s.span,{style:{color:\"#F97583\"},children:\" mut\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" list \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" self\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"iter_ordered\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"collect\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"Vec\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"<_>>();\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"        list\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"sort_by_key\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(key, _)\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" {\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#F97583\"},children:\"            let\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\" key_hashed \"}),n(s.span,{style:{color:\"#F97583\"},children:\"=\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" Key\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"new\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(key\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"as_ref\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"());\"})]}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"            distance_log2\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"key_hashed, \"}),n(s.span,{style:{color:\"#F97583\"},children:\"&\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"target_hashed)\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"map_or\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\"0\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\", \"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"d\"}),n(s.span,{style:{color:\"#F97583\"},children:\"|\"}),n(s.span,{style:{color:\"#B392F0\"},children:\" u16\"}),n(s.span,{style:{color:\"#F97583\"},children:\"::\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"from\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"(d) \"}),n(s.span,{style:{color:\"#F97583\"},children:\"+\"}),n(s.span,{style:{color:\"#79B8FF\"},children:\" 1\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"        });\"})}),\"\\n\",l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#E1E4E8\"},children:\"        list\"}),n(s.span,{style:{color:\"#F97583\"},children:\".\"}),n(s.span,{style:{color:\"#B392F0\"},children:\"into_iter\"}),n(s.span,{style:{color:\"#E1E4E8\"},children:\"()\"})]}),\"\\n\",n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#E1E4E8\"},children:\"    }\"})})]})})}),\"\\n\",l(s.ul,{children:[\"\\n\",n(s.li,{children:\"It obtains the peer with the shortest distance and where it already has an established connection.\"}),\"\\n\"]}),\"\\n\",n(s.h4,{id:\"processing-existing-connections\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#processing-existing-connections\",children:\"Processing existing connections\"})}),\"\\n\",l(s.p,{children:[\"Smoldot has 2 types of connections such as \",n(s.strong,{children:n(s.a,{href:\"https://docs.libp2p.io/concepts/transports/webtransport/\",children:\"TCP\"})}),\" connection and \",n(s.strong,{children:n(s.a,{href:\"https://docs.libp2p.io/concepts/transports/webrtc/\",children:\"WebRTC\"})}),\" connection.\"]}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:\"TCP is the Single Stream connection where the browser just sends or receives data and Smoldot implements substreams on top of that.\"}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",l(s.p,{children:[\"In the \",n(s.strong,{children:\"Multi stream\"}),\" WebRTC connection the browser deals with the substreams.\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(s.p,{children:\"There are two types of substreams:\"}),\"\\n\",l(s.ol,{children:[\"\\n\",l(s.li,{children:[\"Notifications:\",\"\\n\",l(s.ol,{children:[\"\\n\",n(s.li,{children:\"Block announcements protocol\"}),\"\\n\",n(s.li,{children:\"GRANDPA announcements protocol (GRANDPA commits)\"}),\"\\n\",n(s.li,{children:\"Transaction announcements protocol (not implemented for Smoldot)\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"Request-response:\",\"\\n\",l(s.ol,{children:[\"\\n\",n(s.li,{children:\"IPFS id protocol\"}),\"\\n\",n(s.li,{children:\"Sync protocol\"}),\"\\n\",n(s.li,{children:\"Light protocol\"}),\"\\n\",n(s.li,{children:\"Kademlia protocol\"}),\"\\n\",n(s.li,{children:\"Sync warp protocol\"}),\"\\n\",n(s.li,{children:\"State protocol\"}),\"\\n\"]}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(s.h3,{id:\"synchronization-service\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#synchronization-service\",children:\"Synchronization service\"})}),\"\\n\",l(s.p,{children:[\"After, The networking service has been set up it starts a new background task, the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/sync.rs#L18-L69\",children:\"synchronization service\"})}),\". The objective of the sync service is to do whatever necessary to get and stay up to date with the best and finalized blocks of the chain.\"]}),\"\\n\",l(s.p,{children:[\"Generally, Smoldot will track a list of \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/sync/all_forks/sources.rs#L18-L26\",children:\"sources\"})}),\", which represent peers that Smoldot receives new block headers and GRANDPA commits from. With the received information from a given peer, it will know which blocks this peer is aware of.\"]}),\"\\n\",n(s.h3,{id:\"runtime-service\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#runtime-service\",children:\"Runtime service\"})}),\"\\n\",l(s.p,{children:[\"After synchronization service, the next task is the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/bin/light-base/src/runtime_service.rs#L18-L55\",children:\"runtime service\"})}),\". Typically, this service wants to have the latest finalized downloaded runtime to provide to other services. Therefore, it needs to stay up to date with the chain.\"]}),\"\\n\",n(s.h3,{id:\"transaction-service\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#transaction-service\",children:\"Transaction service\"})}),\"\\n\",l(s.p,{children:[\"Everything which relate to transactions will be handled by \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/transactions.rs#L18-L86\",children:\"transaction service\"})}),\". As we know, when the transaction sent from the user to network would be injected to the pool called as \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/transactions/pool.rs#L18-L79\",children:\"transaction pool\"})}),\". This transactions will hold the pending status and wait until mining or validating by active nodes to add to the new blocks. What's about in Light Client? The \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/bin/light-base/src/transactions_service.rs#L18-L68\",children:\"transaction service\"})}),\" and \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/transactions/light_pool.rs#L18-L60\",children:\"transaction pool\"})}),\" are most of the time idle. Because of this, it is only operating when the user submits a transaction.\"]}),\"\\n\",n(s.h3,{id:\"json-rpc-service\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#json-rpc-service\",children:\"JSON-RPC service\"})}),\"\\n\",l(s.p,{children:[\"Finally, as the last asynchronous task, the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/json_rpc.rs#L18-L60\",children:\"JSON-RPC service\"})}),\" will be spawned. It holds a \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/json_rpc/requests_subscriptions.rs#L18-L106\",children:\"state machine\"})}),\" which consists of a list of client, list of request sent by a client but not yet pulled by, and the \",n(s.strong,{children:n(s.a,{href:\"https://github.com/paritytech/smoldot/blob/76994b52cd658a4ac1dc7a08f6bd4eba702e0e87/src/json_rpc/requests_subscriptions.rs#L89-L106\",children:\"request subscriptions\"})})]}),\"\\n\",n(s.h3,{id:\"why-use-substrate-connect-\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#why-use-substrate-connect-\",children:\"Why use Substrate Connect ?\"})}),\"\\n\",l(s.p,{children:[n(s.strong,{children:\"Polkadot\"}),\" is designed with decentralization at its core, following the \",n(s.strong,{children:\"Blockchain Trilemma\"}),\" \",n(s.strong,{children:\"(Decentralization\"}),\", \",n(s.strong,{children:\"Security\"}),\", and \",n(s.strong,{children:\"Scalability)\"}),\". However, most user interfaces connect to the network through centralized nodes, making decentralization challenging. \",n(s.strong,{children:n(s.a,{href:\"https://substrate.io/substrate-connect/\",children:\"Substrate Connect\"})}),\" provides a lightweight, decentralized option for DApps to interact securely with Polkadot, lowering complexity for end-users.\"]}),\"\\n\",n(s.h2,{id:\"integrating-the-light-client-by-smoldot-in-your-user-interface-\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#integrating-the-light-client-by-smoldot-in-your-user-interface-\",children:\"Integrating the Light Client by Smoldot in your User Interface !!!\"})}),\"\\n\",l(s.p,{children:[\"This guide walks you through integrating a Light Client with **\",n(s.a,{href:\"https://github.com/smol-dot/smoldot\",children:\"Smoldot\"}),\" , \",n(s.a,{href:\"https://substrate.io/substrate-connect/\",children:\"Substrate Connect\"}),\" **and \",n(s.strong,{children:n(s.a,{href:\"https://docs.dedot.dev/\",children:\"Dedot\"})}),\" (an alternative to \",n(s.strong,{children:n(s.a,{href:\"https://polkadot.js.org/docs/api/\",children:\"PolkadotJS API\"})}),\" ) in our demo application.\"]}),\"\\n\",l(s.p,{children:[\"Our repository is using \",n(s.strong,{children:\"Next.Js\"}),\" framework to build the \",n(s.strong,{children:\"User-Interface\"}),\" \",n(s.strong,{children:\"Application\"}),\" for Decentralized Application - \",n(s.strong,{children:n(s.a,{href:\"https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client\",children:\"Demo\"})})]}),\"\\n\",n(s.h3,{id:\"prepare-the-chain-specification-json\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#prepare-the-chain-specification-json\",children:\"Prepare the Chain Specification JSON\"})}),\"\\n\",n(s.p,{children:\"Firstly, we must prepare the chain specification json file for the Relaychain or Parachain. We can find the chain specification of our expected network in Substrate Connect repository.\"}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(s.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#B392F0\"},children:\"    https://github.com/paritytech/substrate-connect/tree/main/packages/connect-known-chains/specs\"})})})})}),\"\\n\",n(s.h3,{id:\"install-dependencies\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#install-dependencies\",children:\"Install Dependencies\"})}),\"\\n\",l(s.p,{children:[\"Install necessary packages such as \",n(s.strong,{children:\"smoldot\"}),\" , \",n(s.strong,{children:\"@dedot/chaintypes\"}),\" and a compatible version of \",n(s.strong,{children:\"Dedot\"}),\":\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(s.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"    npm\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:\" install\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:\" smoldot\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:\" dedot@0.5.0\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:\" @dedot/chaintypes\"})]})})})}),\"\\n\",n(s.h3,{id:\"implement-substrate-connect-provider-and-client\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#implement-substrate-connect-provider-and-client\",children:\"Implement Substrate Connect Provider and Client\"})}),\"\\n\",l(s.p,{children:[\"Set up the \",n(s.strong,{children:\"Substrate Connect Provider\"}),\" and \",n(s.strong,{children:\"Client\"}),\" in a custom hook for use in your \",n(s.strong,{children:\"Next.js\"}),\" or \",n(s.strong,{children:\"React\"}),\" project:\"]}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(s.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#B392F0\"},children:\"    https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/blob/main/src/hooks/useApi.ts\"})})})})}),\"\\n\",n(s.p,{children:n(s.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fad2d53e7-f2c3-4ae1-9c41-c96d987e8bba_1514x2390.png\",alt:\"align=center\"})}),\"\\n\",n(s.h3,{id:\"configure-api-context-for-project-layout\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#configure-api-context-for-project-layout\",children:\"Configure API Context for Project Layout\"})}),\"\\n\",n(s.p,{children:\"Integrate the Light Client provider across your application with an API Context setup:\"}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(s.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#B392F0\"},children:\"    https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/blob/main/src/providers/ApiProvider.tsx\"})})})})}),\"\\n\",n(s.p,{children:n(s.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2f375d61-ff45-4a1d-9d80-b35dbf605ef2_1514x2876.png\",alt:\"align=center\"})}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(s.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:n(s.span,{\"data-line\":\"\",children:n(s.span,{style:{color:\"#B392F0\"},children:\"    https://github.com/thai-cong-nguyen/Voting-Escrow-Light-Client/tree/main/src/app\"})})})})}),\"\\n\",n(s.p,{children:n(s.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F42e11e8b-4212-4d0f-80b5-7d9b7baf210e_1514x1460.png\",alt:\"align=center\"})}),\"\\n\",n(s.h3,{id:\"test-the-light-client-connection\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#test-the-light-client-connection\",children:\"Test the Light Client Connection\"})}),\"\\n\",n(s.p,{children:\"Run our application with:\"}),\"\\n\",n(s.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(s.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(s.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:l(s.span,{\"data-line\":\"\",children:[n(s.span,{style:{color:\"#B392F0\"},children:\"    npm\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:\" run\"}),n(s.span,{style:{color:\"#9ECBFF\"},children:\" dev\"})]})})})}),\"\\n\",n(s.p,{children:\"If successful, you‚Äôll see confirmation in the browser console üéâ. This confirms your Light Client is now operational within your Dapp!\"}),\"\\n\",n(s.p,{children:n(s.img,{src:\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4a3718a3-c5bb-44ce-9419-5d101b2497d7_1910x314.png\",alt:\"align=center\"})}),\"\\n\",l(s.p,{children:[\"(\",n(s.a,{href:\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4a3718a3-c5bb-44ce-9419-5d101b2497d7_1910x314.png\",children:\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4a3718a3-c5bb-44ce-9419-5d101b2497d7_1910x314.png\"}),\")\"]}),\"\\n\",l(s.p,{children:[\"In this context, we used the \",n(s.strong,{children:\"Edge Browser\"}),\" to access to our application.\"]}),\"\\n\",n(s.h4,{id:\"interact-with-smart-contracts\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#interact-with-smart-contracts\",children:\"Interact with Smart Contracts\"})}),\"\\n\",l(s.p,{children:[\"Using the ‚Äúapi‚Äù client from the API Context, interact with the Relaychain or Parachain via \",n(s.strong,{children:n(s.a,{href:\"https://docs.dedot.dev/\",children:\"Dedot SDK\"})}),\" or \",n(s.strong,{children:n(s.a,{href:\"https://polkadot.js.org/docs/api/\",children:\"PolkadotJS API\"})}),\" to call smart contracts.\"]}),\"\\n\",n(s.h2,{id:\"challenges-\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#challenges-\",children:\"Challenges üí™üèª\"})}),\"\\n\",l(s.p,{children:[\"The \",n(s.strong,{children:\"Smoldot SDK\"}),\" supports \",n(s.strong,{children:\"WASM-compatible\"}),\" browsers, so ensure your Dapp runs on a browser optimized for WASM.\"]}),\"\\n\",n(s.h2,{id:\"acknowledgement\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#acknowledgement\",children:\"Acknowledgement\"})}),\"\\n\",l(s.p,{children:[\"This article is the part of \",n(s.strong,{children:n(s.a,{href:\"https://app.openguild.wtf/missions/32\",children:\"Open Contribution Bounty\"})}),\" initiative by the \",n(s.strong,{children:\"OpenGuild Community\"}),\". A heartfelt thank you to \",n(s.strong,{children:\"OpenGuild\"}),\" for being a pioneering community that empowers and supports emerging developers in the Blockchain space, particularly within the Polkadot ecosystem.\"]}),\"\\n\",n(s.h2,{id:\"references\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#references\",children:\"References\"})}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:n(s.strong,{children:n(s.a,{href:\"https://github.com/CocDap/staking-ui\",children:\"Example Staking UI Repository - Author: CocDap\"})})}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:n(s.strong,{children:n(s.a,{href:\"https://forum.polkadot.network/t/introducing-dedot-a-delightful-javascript-client-for-polkadot-substrate-based-blockchains/8956\",children:\"Introducing Dedot: A delightful JavaScript client for Polkadot& Substrate-based blockchains\"})})}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:n(s.strong,{children:n(s.a,{href:\"https://forum.polkadot.network/t/polkadot-provider-api-a-common-interface-for-building-decentralized-applications/4128\",children:\"Polkadot Provider API: a common interface for building decentralized applications\"})})}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:n(s.strong,{children:n(s.a,{href:\"https://forum.polkadot.network/t/smoldot-updates-threads/4471\",children:\"Smoldot updates threads\"})})}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:n(s.strong,{children:n(s.a,{href:\"https://github.com/smol-dot/smoldot\",children:\"smol-dot/smoldot - Lightweight client for Substrate-based chains\"})})}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:n(s.strong,{children:n(s.a,{href:\"https://www.parity.io/blog/introducing-substrate-connect\",children:\"Introducing Substrate Connect: Browser-Based Light Clients for Connecting to Substrate Chains | Parity Technologies\"})})}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",n(s.p,{children:n(s.strong,{children:n(s.a,{href:\"https://hackmd.io/@s_iGZLIITG6WjSgnFX0pcg/rkmmcvBno#Runtime-service\",children:\"Smoldot: Hello, world!\"})})}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(s.h2,{id:\"about-the-author-\",children:n(s.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#about-the-author-\",children:\"About the Author üëãüèª\"})}),\"\\n\",l(s.p,{children:[n(s.strong,{children:\"Bio\"}),\" : \",l(s.em,{children:[\"Harry Riddle, an undergraduate Web3 Developer focused on Blockchain and AI, is a member of the \",n(s.strong,{children:\"OpenGuild\"}),\" community in Vietnam.\"]})]}),\"\\n\",l(s.p,{children:[n(s.strong,{children:\"Contact info\"}),\" :\"]}),\"\\n\",l(s.ul,{children:[\"\\n\",l(s.li,{children:[\"\\n\",l(s.p,{children:[n(s.strong,{children:\"X/Twitter\"}),\" : \",n(s.a,{href:\"https://x.com/0xHarryNguyenVN\",children:\"0xHarryNguyenVN\"})]}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",l(s.p,{children:[n(s.strong,{children:\"Telegram\"}),\" : \",n(s.a,{href:\"https://t.me/HarryRiddle\",children:\"@HarryRiddle\"})]}),\"\\n\"]}),\"\\n\",l(s.li,{children:[\"\\n\",l(s.p,{children:[n(s.strong,{children:\"Discord\"}),\" : \",n(s.a,{href:\"http://@harrynguyen2107\",children:\"@harrynguyen2107\"})]}),\"\\n\"]}),\"\\n\"]})]})}return{default:function(e={}){const{wrapper:l}=e.components||{};return l?n(l,{...e,children:n(_createMdxContent,{...e})}):_createMdxContent(e)}};","slugAsParams":"light-client-polkadot/light-client-polkadot"}]